import{_ as s,c as a,o as n,d as o}from"./app.049dd9f4.js";const C=JSON.parse('{"title":"Storages","description":"","frontmatter":{},"headers":[{"level":2,"title":"Memory Storage","slug":"memory-storage","link":"#memory-storage","children":[]},{"level":2,"title":"Web Storage API","slug":"web-storage-api","link":"#web-storage-api","children":[{"level":3,"title":"Browser quota","slug":"browser-quota","link":"#browser-quota","children":[]}]},{"level":2,"title":"buildStorage()","slug":"buildstorage","link":"#buildstorage","children":[]},{"level":2,"title":"Third Party Storages","slug":"third-party-storages","link":"#third-party-storages","children":[]},{"level":2,"title":"Node Redis storage","slug":"node-redis-storage","link":"#node-redis-storage","children":[]}],"relativePath":"guide/storages.md","lastUpdated":1685031646000}'),l={name:"guide/storages.md"},e=o(`<h1 id="storages" tabindex="-1">Storages <a class="header-anchor" href="#storages" aria-hidden="true">#</a></h1><p>Storages are the responsible to save, retrieve and serialize (if needed) cache data. They are completely customizable and you can code or using another one’s published on NPM.</p><p>They are meant to be the middleware between the cache interceptor and some sort of database (persistent or not) you may have. Our interceptors will call its methods internally to save and retrieve data. But you can do it manually to work programmatically on your way.</p><p>Currently, two storages are included in the library by default:</p><ul><li><a href="#memory-storage">Memory Storage</a> accessible with <code>buildMemoryStorage</code> <em>(works on Node and Web)</em></li><li><a href="#web-storage-api">Web Storage API</a> accessible with <code>buildWebStorage</code> <em>(works on Web only)</em></li></ul><h2 id="memory-storage" tabindex="-1">Memory Storage <a class="header-anchor" href="#memory-storage" aria-hidden="true">#</a></h2><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p><strong>This is the storage chosen by default</strong></p></div><p>A memory storage is the simplest one. It works everywhere and its values are lost upon page reload or when the process is killed.</p><p>If you are directly mutating some response property, you probably will face some reference issues because the storage will also get mutated. To avoid that, you can use the <code>clone</code> option to clone the response before saving it. <em>Just like <a href="https://github.com/arthurfiorette/axios-cache-interceptor/issues/163" target="_blank" rel="noreferrer">#136</a> and many others.</em></p><p>For long running processes, you can avoid memory leaks by using playing with the <code>cleanupInterval</code> option. And can reduce memory usage with <code>maxEntries</code>.</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> Axios </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">axios</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">setupCache</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">buildMemoryStorage</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">axios-cache-interceptor</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">setupCache</span><span style="color:#A6ACCD;">(axios</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// You don&#39;t need to to that, as it is the default option.</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">storage</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">buildMemoryStorage</span><span style="color:#A6ACCD;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;">/* cloneData default=*/</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;">/* cleanupInterval default=*/</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;">/* maxEntries default=*/</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">false</span></span>
<span class="line"><span style="color:#A6ACCD;">  )</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><h2 id="web-storage-api" tabindex="-1">Web Storage API <a class="header-anchor" href="#web-storage-api" aria-hidden="true">#</a></h2><p>If you need persistent caching between page refreshes, you can use the <code>buildWebStorage</code> to get this behavior. It works by connecting our storage API to the browser’s <a href="https://developer.mozilla.org/en-US/docs/Web/API/Storage" target="_blank" rel="noreferrer">Storage API</a>.</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-TSO_r" id="tab-MK_K7ts" checked="checked"><label for="tab-MK_K7ts">Local Storage</label><input type="radio" name="group-TSO_r" id="tab-M40W6Zw"><label for="tab-M40W6Zw">Session Storage</label><input type="radio" name="group-TSO_r" id="tab-4-8SzfU"><label for="tab-4-8SzfU">Custom Storage</label></div><div class="blocks"><div class="language-ts active"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight has-focused-lines has-highlighted-lines"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> Axios </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">axios</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">setupCache</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">buildWebStorage</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">axios-cache-interceptor</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line has-focus"><span style="color:#82AAFF;">setupCache</span><span style="color:#A6ACCD;">(axios</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span></span>
<span class="line has-focus"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// As localStorage is a public storage, you can add a prefix</span></span>
<span class="line has-focus"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// to all keys to avoid collisions with other code.</span></span>
<span class="line has-focus highlighted"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">storage</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">buildWebStorage</span><span style="color:#A6ACCD;">(localStorage</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">axios-cache:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line has-focus"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight has-focused-lines has-highlighted-lines"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> Axios </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">axios</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">setupCache</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">buildWebStorage</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">axios-cache-interceptor</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line has-focus"><span style="color:#82AAFF;">setupCache</span><span style="color:#A6ACCD;">(axios</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span></span>
<span class="line has-focus"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// As sessionStorage is a public storage, you can add a prefix</span></span>
<span class="line has-focus"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// to all keys to avoid collisions with other code.</span></span>
<span class="line has-focus highlighted"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">storage</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">buildWebStorage</span><span style="color:#A6ACCD;">(sessionStorage</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">axios-cache:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line has-focus"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight has-focused-lines has-highlighted-lines"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> Axios </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">axios</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">setupCache</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">buildWebStorage</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">axios-cache-interceptor</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line has-focus highlighted"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> myStorage </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Storage</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span></span>
<span class="line has-focus"></span>
<span class="line has-focus"><span style="color:#82AAFF;">setupCache</span><span style="color:#A6ACCD;">(axios</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line has-focus highlighted"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">storage</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">buildWebStorage</span><span style="color:#A6ACCD;">(myStorage)</span></span>
<span class="line has-focus"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div></div></div><h3 id="browser-quota" tabindex="-1">Browser quota <a class="header-anchor" href="#browser-quota" aria-hidden="true">#</a></h3><p>From <code>v0.9.0</code> onwards, web storage is able to detect and evict older entries if the browser’s quota is reached.</p><p>The eviction is done by the following algorithm:</p><ol><li>Just saved an value and got an error. <em>(Probably quota exceeded)</em></li><li>Evicts all expired keys that cannot enter the <code>stale</code> state.</li><li>If it fails again, evicts the oldest key with the given prefix.</li><li>Repeat step 2 and 3 until the object can be saved or the storage has been emptied.</li><li>If it still fails, the data is not saved. <em>Probably because the whole key is greater than the quota or other libraries already consumed the whole usable space.</em></li></ol><h2 id="buildstorage" tabindex="-1">buildStorage() <a class="header-anchor" href="#buildstorage" aria-hidden="true">#</a></h2><p>All integrated storages are wrappers around the <code>buildStorage</code> function. External libraries use it and if you want to build your own, <code>buildStorage</code> is the way to go!</p><p>The exported <code>buildStorage</code> function abstracts the storage interface and requires a super simple object to build the storage. It has 3 methods:</p><ul><li><p><code>set(key: string, value: NotEmptyStorageValue, currentRequest?: CacheRequestConfig): MaybePromise&lt;void&gt;</code>: Receives the key and the value, and optionally the current request. It should save the value in the storage.</p></li><li><p><code>remove(key: string, currentRequest?: CacheRequestConfig): MaybePromise&lt;void&gt;</code>: Receives the key and optionally the current request. It should remove the value from the storage.</p></li><li><p><code>find(key: string, currentRequest?: CacheRequestConfig) =&gt; MaybePromise&lt;StorageValue | undefined&gt;</code>: Receives the key and optionally the current request. It should return the value from the storage or <code>undefined</code> if not found.</p></li></ul><h2 id="third-party-storages" tabindex="-1">Third Party Storages <a class="header-anchor" href="#third-party-storages" aria-hidden="true">#</a></h2><p>These are not guaranteed to work with the latest version of the library, neither are maintained by the axios cache interceptor team. But, as we provide a minimal interface for storages, you can use them as a base to also create your own.</p><ul><li><a href="#node-redis-v4-example">Node Redis v4</a></li><li><strong>Have another one?</strong></li><li><a href="https://github.com/arthurfiorette/axios-cache-interceptor/pulls" target="_blank" rel="noreferrer">Open a PR</a> to add it here.</li></ul><h2 id="node-redis-storage" tabindex="-1">Node Redis storage <a class="header-anchor" href="#node-redis-storage" aria-hidden="true">#</a></h2><p>The node redis storage implementation is listed here because it shows the only tricky part when implementing a storage with an third party client that allows auto-evicting entries, as show on the <code>PXAT</code> property.</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight has-focused-lines has-highlighted-lines"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">createClient</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">redis</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// v4</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">buildStorage</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">canStale</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">axios-cache-interceptor</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> client </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">createClient</span><span style="color:#A6ACCD;">(</span><span style="color:#676E95;font-style:italic;">/* connection config */</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line has-focus"></span>
<span class="line has-focus"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> redisStorage </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">buildStorage</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line has-focus"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">find</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">key</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line has-focus"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">client</span></span>
<span class="line has-focus"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">axios-cache-</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">key</span><span style="color:#89DDFF;">}\`</span><span style="color:#F07178;">)</span></span>
<span class="line has-focus"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">result</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">result</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">JSON</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">parse</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">result</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;font-style:italic;">as</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">StorageValue</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line has-focus"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line has-focus"></span>
<span class="line has-focus"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">set</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">key</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">value</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">req</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line has-focus"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">client</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">set</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">axios-cache-</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">key</span><span style="color:#89DDFF;">}\`</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">JSON</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">stringify</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line has-focus"><span style="color:#F07178;">      PXAT</span><span style="color:#89DDFF;">:</span></span>
<span class="line has-focus"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// We don&#39;t want to keep indefinitely values in the storage if</span></span>
<span class="line has-focus"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// their request don&#39;t finish somehow. Either set its value as</span></span>
<span class="line has-focus"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// the TTL or 1 minute.</span></span>
<span class="line has-focus"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">value</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">state</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">loading</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line has-focus"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">?</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Date</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">now</span><span style="color:#F07178;">() </span><span style="color:#89DDFF;">+</span></span>
<span class="line has-focus"><span style="color:#F07178;">            (</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">?.</span><span style="color:#A6ACCD;">cache</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">typeof</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">cache</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">ttl</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">number</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line has-focus"><span style="color:#F07178;">              </span><span style="color:#89DDFF;">?</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">cache</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">ttl</span></span>
<span class="line has-focus"><span style="color:#F07178;">              </span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// 1 minute in seconds</span></span>
<span class="line has-focus"><span style="color:#F07178;">                </span><span style="color:#F78C6C;">60000</span><span style="color:#F07178;">)</span></span>
<span class="line has-focus"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// When a stale state has a determined value to expire, we can use it.</span></span>
<span class="line has-focus"><span style="color:#89DDFF;">          </span><span style="color:#676E95;font-style:italic;">//   Or if the cached value cannot enter in stale state.</span></span>
<span class="line has-focus"><span style="color:#F07178;">          (</span><span style="color:#A6ACCD;">value</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">state</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">stale</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">value</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">ttl</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">||</span></span>
<span class="line has-focus"><span style="color:#F07178;">            (</span><span style="color:#A6ACCD;">value</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">state</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">cached</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!</span><span style="color:#82AAFF;">canStale</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;">))</span></span>
<span class="line has-focus"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">?</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// eslint-disable-next-line @typescript-eslint/no-non-null-assertion</span></span>
<span class="line has-focus"><span style="color:#F07178;">            </span><span style="color:#A6ACCD;">value</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">createdAt</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">value</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">ttl</span><span style="color:#89DDFF;">!</span></span>
<span class="line has-focus"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// otherwise, we can&#39;t determine when it should expire, so we keep</span></span>
<span class="line has-focus"><span style="color:#89DDFF;">            </span><span style="color:#676E95;font-style:italic;">//   it indefinitely.</span></span>
<span class="line has-focus"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">undefined</span></span>
<span class="line has-focus"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line has-focus"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line has-focus"></span>
<span class="line has-focus"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">remove</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">key</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line has-focus"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">client</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">del</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">axios-cache-</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">key</span><span style="color:#89DDFF;">}\`</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line has-focus"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line has-focus"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>However you can use the <a href="#bui"><code>buildStorage</code></a> function to integrate with ANY storage you want, like <code>localForage</code>, <code>ioredis</code>, <code>memcache</code> and others.</p>`,29),p=[e];function t(r,c,y,i,D,F){return n(),a("div",null,p)}const h=s(l,[["render",t]]);export{C as __pageData,h as default};
